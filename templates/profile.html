{% extends "base.html" %}

{% block title %}Profile - {{ user.username }}{% endblock %}

{% block content %}
<div class="container">
    <h1>Profile</h1>
    <div class="user-info">
        <p><strong>Username:</strong> {{ user.username }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
    </div>
    
    <h2>Game Statistics</h2>
    <div class="stats-container">
        {% for difficulty in ['easy', 'medium', 'hard'] %}
            <div class="stats-box">
                <h3>{{ difficulty.capitalize() }} Mode</h3>
                {% set stats = user_stats.get(difficulty, {'total_games': 0, 'avg_score': 0, 'highest_score': 0}) %}
                <p><strong>Total Games:</strong> {{ stats.total_games }}</p>
                <p><strong>Average Score:</strong> {{ "%.2f"|format(stats.avg_score) }}</p>
                <p><strong>Highest Score:</strong> {{ stats.highest_score }}</p>
            </div>
        {% endfor %}
    </div>
    
    <div class="fancy-divider"></div>
    
    <h2>About {{ user.username }}</h2>
    <form id="about-form" class="about-form">
        <textarea id="about-text" maxlength="200" placeholder="{{ user.about or 'Things about me...' }}"></textarea>
        <button type="submit">Save</button>
    </form>
    
    <h2>Recent High Scores</h2>
    {% if high_scores %}
        <table>
            <thead>
                <tr>
                    <th>Difficulty</th>
                    <th>Score</th>
                </tr>
            </thead>
            <tbody>
                {% for score in high_scores %}
                    <tr>
                        <td>{{ score.difficulty.capitalize() }}</td>
                        <td>{{ score.score }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No high scores yet. Start playing to set some records!</p>
    {% endif %}
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('about-form').addEventListener('submit', function(e) {
    e.preventDefault();
    const aboutText = document.getElementById('about-text').value;
    fetch('/update_about', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ about: aboutText }),
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('about-text').placeholder = aboutText;
            document.getElementById('about-text').value = '';
        } else {
            alert('Failed to update about text');
        }
    })
    .catch((error) => {
        console.error('Error:', error);
        alert('An error occurred while updating about text');
    });
});
</script>
{% endblock %}